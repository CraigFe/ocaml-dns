<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dns_server (dns-lwt.Dns_server)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">dns-lwt</a> &#x00BB; Dns_server</nav><h1>Module <code>Dns_server</code></h1><p>The main purpose of this module is to provide an implementation of a standard DNS server based on <a href="../../dns/Dns/Query/index.html"><code>Query</code></a> and <a href="../../dns/Dns/Loader/index.html"><code>Loader</code></a>.</p><p>For a basic DNS server, call <a href="index.html#val-process_of_zonebuf"><code>process_of_zonebuf</code></a>, pass the result to <a href="index.html#val-processor_of_process"><code>processor_of_process</code></a>, and then invoke the resulting processor function for each received packet.</p><p>This module also provides a way to override the parsing and marshaling of DNS packets to allow extensions of DNS to be implemented, such as DNSCurve.</p></header><dl><dt class="spec type" id="type-ip_endpoint"><a href="#type-ip_endpoint" class="anchor"></a><code><span class="keyword">type </span>ip_endpoint</code><code><span class="keyword"> = </span>Ipaddr.t<span class="keyword"> * </span>int</code></dt><dd><p>A tuple consisting of an IPv4 or IPv6 address and a TCP or UDP port number.</p></dd></dl><dl><dt class="spec type" id="type-process"><a href="#type-process" class="anchor"></a><code><span class="keyword">type </span>'a process</code><code><span class="keyword"> = </span>src:<a href="index.html#type-ip_endpoint">ip_endpoint</a> <span>&#45;&gt;</span> dst:<a href="index.html#type-ip_endpoint">ip_endpoint</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="../../dns/Dns/Query/index.html#type-answer">Dns.Query.answer</a> option Lwt.t</code></dt><dd><p>A type of function that takes an abstract request plus source and destination endpoint addresses, and asynchronously produces an answer to the request, or None if no answer is possible. For most applications the type <code>'a</code> will be <a href="../../dns/Dns/Packet/index.html#type-t"><code>Packet.t</code></a>, but may be different if a custom parsing/marshalling layer is required.</p></dd></dl><dl><dt class="spec module-type" id="module-type-PROCESSOR"><a href="#module-type-PROCESSOR" class="anchor"></a><code><span class="keyword">module type </span><a href="module-type-PROCESSOR/index.html">PROCESSOR</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>This type of module provides functions for parsing, marshalling and processing DNS requests to produce answers.</p></dd></dl><dl><dt class="spec type" id="type-processor"><a href="#type-processor" class="anchor"></a><code><span class="keyword">type </span>'a processor</code><code><span class="keyword"> = </span>(<span class="keyword">module </span><a href="module-type-PROCESSOR/index.html">PROCESSOR</a> <span class="keyword">with</span> <span class="keyword">type </span><a href="module-type-PROCESSOR/index.html#type-context">context</a> <span class="keyword">=</span> <span class="type-var">'a</span>)</code></dt></dl><dl><dt class="spec value" id="val-compose"><a href="#val-compose" class="anchor"></a><code><span class="keyword">val </span>compose : <a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a> <a href="index.html#type-process">process</a> <span>&#45;&gt;</span> <a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a> <a href="index.html#type-process">process</a> <span>&#45;&gt;</span> <a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a> <a href="index.html#type-process">process</a></code></dt><dd><p><code>compose process backup_process</code> is <code>process</code> unless it returns an <code>rcode</code> other than <code>NoError</code> in which case it becomes <code>backup_process</code>.</p></dd></dl><dl><dt class="spec value" id="val-process_query"><a href="#val-process_query" class="anchor"></a><code><span class="keyword">val </span>process_query : ?&#8288;alloc:(unit <span>&#45;&gt;</span> Cstruct.t) <span>&#45;&gt;</span> Cstruct.t <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="index.html#type-ip_endpoint">ip_endpoint</a> <span>&#45;&gt;</span> <a href="index.html#type-ip_endpoint">ip_endpoint</a> <span>&#45;&gt;</span> (<span class="keyword">module </span><a href="module-type-PROCESSOR/index.html">PROCESSOR</a>) <span>&#45;&gt;</span> Cstruct.t option Lwt.t</code></dt><dd><p><code>process_query ?alloc ibuf ibuflen src dst processor</code></p></dd></dl><dl><dt class="spec value" id="val-processor_of_process"><a href="#val-processor_of_process" class="anchor"></a><code><span class="keyword">val </span>processor_of_process : <a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a> <a href="index.html#type-process">process</a> <span>&#45;&gt;</span> <a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a> <a href="index.html#type-processor">processor</a></code></dt><dd><p>Returns a packet processor module by combining <a href="../../dns/Dns/Protocol/Server/index.html"><code>Protocol.Server</code></a> with the specified packet processing function.</p></dd></dl><dl><dt class="spec value" id="val-process_of_zonebufs"><a href="#val-process_of_zonebufs" class="anchor"></a><code><span class="keyword">val </span>process_of_zonebufs : string list <span>&#45;&gt;</span> <a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a> <a href="index.html#type-process">process</a></code></dt><dd><p>Given a list of DNS zone files as strings, parses them using <a href="../../dns/Dns/Loader/index.html"><code>Loader</code></a> and returns a processing function that answers requests through the use of <a href="../../dns/Dns/Query/index.html"><code>Query</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-process_of_zonebuf"><a href="#val-process_of_zonebuf" class="anchor"></a><code><span class="keyword">val </span>process_of_zonebuf : string <span>&#45;&gt;</span> <a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a> <a href="index.html#type-process">process</a></code></dt><dd><p>This is a convenience function that is equivalent to calling <a href="index.html#val-process_of_zonebufs"><code>process_of_zonebufs</code></a> with a list containing a single zone file string.</p></dd></dl></div></body></html>